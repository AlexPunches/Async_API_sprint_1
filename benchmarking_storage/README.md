# Бенчмаркинг Монги (черновик)

В БД ~100М документов в одной коллекции.
315 юзеров, 1000 фильмов. 
Каждый юзер дал оценку и ревью каждому фильму, и поставил лайк/дизлайк каждому ревью, кроме своего.

### Примеры запросов:

Найти все ракции на фильм:
```javascript
db.reactions.find( {
	"target_id": "b934718f-2d49-4ca2-81f4-317df5141524",
	"target_type": "movie"
})
```
- без индекса: 244000 миллсек
- с индексом: от 400 миллсек до 2 миллсек (кешируется похоже)

Продолжение следует...


# Результаты Бенчмаркинга. Кликхаус против Вертики

Рекомендуемое количество строк при добавлениее в колоночную БД это более 10К 
Впринципе, наши эесперименты это подтверждают. 
Время добавления сильно увеличивается при размере пачики данных в 1000 строк.

Сравнивая БД (Кликхаус и Вертика) следует ориентироваться на значения 10К и более.
И будем ориентироваться на однопоточное добавление данных, 
поскольку многопоточное имеет слысл проводить на шардах, разнесенных на разные сервера (и диски), Иначе общий диск шардов может ограничивать (наверно).
В нашем учебном случае поднимать так много серверов это будет наверно лишним и дороговатым.

Но ради любопытства, попробуем почувстровать многопоточность на шардах в кликхаусе, пускай и на одной машине. 


В сравнении уверенно побеждает Кликхаус.

| кол-во строк/<br/>размер чанки | Кликхаус | Вертика | Только Фейкер | async Кликхаус[^1] |
|:-------------------------------|---------:|--------:|--------------:|-------------------:|
| 11M                            |          |         |               |                    |
| 10 ** 2                        |     4771 |    5917 |            31 |                 -- |
| 10 ** 3                        |      412 |     636 |            33 |                225 |
| 10 ** 4                        |      163 |     290 |            35 |                 65 |
| 10 ** 5                        |      148 |     247 |            36 |                 57 |
| 10 ** 6                        |      145 |     245 |            37 |                 56 |
| 111M                           |          |         |               |                    |
| 10 ** 2                        |       -- |      -- |               |                 -- |
| 10 ** 3                        |     5839 |    6470 |               |               5814 |
| 10 ** 4                        |     1805 |    2923 |               |               1145 |
| 10 ** 5                        |     1691 |    2535 |               |               1006 |
| 10 ** 6                        |     1486 |    2502 |           385 |                err |
| 10 ** 7                        |     1444 |    2523 |               |                    |

[^1]: 3 шарда на одной машине в докерах  

